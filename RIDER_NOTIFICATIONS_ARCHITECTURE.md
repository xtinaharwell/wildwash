# Rider Notification System - Architecture & Data Flow

## System Architecture Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        WILDWASH SYSTEM                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚  Customer   â”‚
                            â”‚   (Web)     â”‚
                            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                            Creates Order
                                   â”‚
                                   â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚    Backend (Django)      â”‚
                    â”‚                          â”‚
                    â”‚  Order.post_save signal  â”‚
                    â”‚  â†“                       â”‚
                    â”‚  Find Riders by          â”‚
                    â”‚  service_location        â”‚
                    â”‚  â†“                       â”‚
                    â”‚  Create Notification    â”‚
                    â”‚  type='new_order'        â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚       â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”    â”‚
                    â”‚Database â”‚    â”‚
                    â”‚Notif #1 â”‚    â”‚
                    â”‚Notif #2 â”‚    â”‚
                    â”‚Notif #3 â”‚    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
                                   â”‚
                    Stored in Database
                                   â”‚
                                   â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚          Rider Dashboard (Frontend)                 â”‚
        â”‚                                                      â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
        â”‚  â”‚ useRiderNotifications Hook                  â”‚   â”‚
        â”‚  â”‚                                              â”‚   â”‚
        â”‚  â”‚  Every 5 Seconds:                           â”‚   â”‚
        â”‚  â”‚  1. Poll API /notifications/                â”‚   â”‚
        â”‚  â”‚     â””â”€> fetch new_order type               â”‚   â”‚
        â”‚  â”‚  2. Check for NEW notifications            â”‚   â”‚
        â”‚  â”‚  3. If found:                               â”‚   â”‚
        â”‚  â”‚     â””â”€> Play Sound (ğŸ”Š)                    â”‚   â”‚
        â”‚  â”‚     â””â”€> Browser Notification (ğŸ””)          â”‚   â”‚
        â”‚  â”‚     â””â”€> Mark as Read (âœ…)                  â”‚   â”‚
        â”‚  â”‚  4. Prevent Duplicates (Set tracking)      â”‚   â”‚
        â”‚  â”‚                                              â”‚   â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
        â”‚                                                      â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Data Flow - Step by Step

### Step 1: Order Creation

```
Customer                    Backend                    Database
   â”‚                           â”‚                          â”‚
   â”‚â”€ Create Order â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                          â”‚
   â”‚                           â”‚â”€â”€ Validate â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚                           â”‚â”€â”€ Insert Order â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚                           â”‚<â”€ Order ID â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
   â”‚<â”€ Order Created â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                          â”‚
   â”‚                           â”‚                          â”‚
```

**Key Data:**

- order.id = 42
- order.code = "WW-ABC123"
- order.service_location = Location(id=1, name="Nairobi")
- order.pickup_address = "123 Main St"

---

### Step 2: Signal Fires (Automatic)

```
Backend                     Database                    Django Signal
   â”‚                           â”‚                           â”‚
   â”‚<â”€ Order Saved â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                           â”‚
   â”‚                           â”‚                           â”‚
   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Post-Save Signal â”€â”€â”€â”€>â”‚
   â”‚                                                        â”‚
   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Query: Get Riders at Location 1 â”€â”€â”€â”€â”€â”€â”‚
   â”‚
   Riders Found:
   - rider_id=5 (john@...rider)
   - rider_id=8 (jane@...rider)
```

**Signal Logic:**

```python
if order.service_location:
    riders = User.objects.filter(
        service_location=order.service_location,
        role='rider',
        is_active=True
    )
    for rider in riders:
        Notification.objects.create(...)
```

---

### Step 3: Notifications Created

```
Backend                    Database                   API
   â”‚                          â”‚                        â”‚
   â”‚â”€ Create Notif 1 â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                        â”‚
   â”‚  (user=5, order=42)       â”‚â”€â”€ Insert â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚                           â”‚                       â”‚
   â”‚â”€ Create Notif 2 â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                        â”‚
   â”‚  (user=8, order=42)       â”‚â”€â”€ Insert â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚                           â”‚                       â”‚
   â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”               â”‚
   â”‚                    â”‚Notification â”‚               â”‚
   â”‚                    â”‚ - id: 101    â”‚               â”‚
   â”‚                    â”‚ - user: 5    â”‚               â”‚
   â”‚                    â”‚ - order: 42  â”‚               â”‚
   â”‚                    â”‚ - type: new  â”‚               â”‚
   â”‚                    â”‚ - read: falseâ”‚               â”‚
   â”‚                    â”‚ - msg: "New  â”‚               â”‚
   â”‚                    â”‚   order..."  â”‚               â”‚
   â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
```

---

### Step 4: Rider Dashboard Polls

```
Rider Dashboard          Frontend Hook              Backend API
       â”‚                      â”‚                         â”‚
       â”‚                      â”‚                         â”‚
    [5s timer]               â”‚                         â”‚
       â”‚                      â”‚                         â”‚
       â”‚                   [Poll]                       â”‚
       â”‚                      â”‚â”€ GET /notifications/ â”€â”€>â”‚
       â”‚                      â”‚                    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
       â”‚                      â”‚                    â”‚ Query DB â”‚
       â”‚                      â”‚                    â”‚ Filter:  â”‚
       â”‚                      â”‚                    â”‚ user=5   â”‚
       â”‚                      â”‚                    â”‚ is_read  â”‚
       â”‚                      â”‚                    â”‚ =false   â”‚
       â”‚                      â”‚                    â”‚ type=    â”‚
       â”‚                      â”‚                    â”‚ new_orderâ”‚
       â”‚                      â”‚                    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
       â”‚                      â”‚<â”€ [Notif 101] â”€â”€â”€â”€â”€â”€â”€â”€â”‚
       â”‚                      â”‚                       â”‚
```

**API Response:**

```json
[
  {
    "id": 101,
    "user": 5,
    "order": 42,
    "message": "New order WW-ABC123 in your area. Pickup: 123 Main St...",
    "notification_type": "new_order",
    "created_at": "2025-11-14T10:30:00Z",
    "is_read": false
  }
]
```

---

### Step 5: Notification Processing

```
Frontend Hook            JS Functions              Browser
       â”‚                      â”‚                      â”‚
    [New Notif Found]         â”‚                      â”‚
       â”‚                      â”‚                      â”‚
       â”œâ”€ playNotificationSound()                   â”‚
       â”‚      â”‚                                      â”‚
       â”‚      â”œâ”€ Audio Context                      â”‚
       â”‚      â””â”€ 800Hz Tone â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> ğŸ”Š SOUND
       â”‚                                             â”‚
       â”œâ”€ Browser Notification                      â”‚
       â”‚      â”‚                                      â”‚
       â”‚      â””â”€ Notification API â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> ğŸ”” ALERT
       â”‚                                             â”‚
       â”œâ”€ markNotificationAsRead(101)               â”‚
       â”‚      â”‚                                      â”‚
       â”‚      â””â”€ POST /notifications/101/mark_read/ â”€>
       â”‚                                             â”‚
```

---

## Component Interaction Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Rider Page (app/rider/page.tsx)             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ useRiderNotifications Hook                       â”‚   â”‚
â”‚  â”‚ â”œâ”€ useEffect on mount                           â”‚   â”‚
â”‚  â”‚ â”œâ”€ setInterval (every 5s)                       â”‚   â”‚
â”‚  â”‚ â””â”€ cleanup on unmount                           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚           â”‚                                             â”‚
â”‚           â”œâ”€â”€> lib/notifications.ts                     â”‚
â”‚           â”‚    â”œâ”€ fetchRiderNotifications()            â”‚
â”‚           â”‚    â”‚  â””â”€ fetch('/notifications/')          â”‚
â”‚           â”‚    â”‚                                       â”‚
â”‚           â”‚    â”œâ”€ playNotificationSound()              â”‚
â”‚           â”‚    â”‚  â””â”€ Web Audio API                     â”‚
â”‚           â”‚    â”‚                                       â”‚
â”‚           â”‚    â””â”€ markNotificationAsRead()             â”‚
â”‚           â”‚       â””â”€ fetch('/notifications/{id}/')     â”‚
â”‚           â”‚                                             â”‚
â”‚           â””â”€â”€> Backend API                             â”‚
â”‚                â”œâ”€ GET /notifications/                  â”‚
â”‚                â”œâ”€ POST /notifications/{id}/mark_read/  â”‚
â”‚                â””â”€ Token Auth                           â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Database Schema Relationships

```
User (Rider)                Order                  Location
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ id: 5           â”‚      â”‚ id: 42           â”‚   â”‚ id: 1        â”‚
â”‚ username: john  â”‚      â”‚ code: WW-ABC123  â”‚   â”‚ name: Nairobiâ”‚
â”‚ role: rider     â”‚      â”‚ user: 3          â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ service_loc: 1  â”‚â”€â”€â”€â”  â”‚ service_loc: 1   â”‚â”€â”€â”€â”
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚ pickup_addr:...  â”‚   â”‚
                      â”‚  â”‚ status: requestedâ”‚   â”‚
User (Rider)          â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚                         â”‚
â”‚ id: 8           â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ username: jane  â”‚                 â”‚
â”‚ role: rider     â”‚                 â”‚
â”‚ service_loc: 1  â”‚â”€â”€â”€â”             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚             â”‚
                      â”‚             â”‚
                      â””â”€â”€> Notification
                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                           â”‚ id: 101          â”‚
                           â”‚ user: 5 (john)   â”‚
                           â”‚ order: 42        â”‚
                           â”‚ type: new_order  â”‚
                           â”‚ is_read: false   â”‚
                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                           Notification
                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                           â”‚ id: 102          â”‚
                           â”‚ user: 8 (jane)   â”‚
                           â”‚ order: 42        â”‚
                           â”‚ type: new_order  â”‚
                           â”‚ is_read: false   â”‚
                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Notification Lifecycle

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ NOTIFICATION LIFECYCLE                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  1. CREATED
     â”œâ”€ POST: Order created
     â”œâ”€ Signal fires
     â”œâ”€ Notification row inserted
     â””â”€ Status: is_read=false

           â”‚
           â–¼

  2. UNREAD
     â”œâ”€ Polling detects new notification
     â”œâ”€ Sound plays (ğŸ”Š)
     â”œâ”€ Browser notification shows (ğŸ””)
     â”œâ”€ Message: "New order WW-ABC123 in your area"
     â””â”€ Status: is_read=false

           â”‚
           â–¼

  3. READ
     â”œâ”€ Frontend calls POST /mark_read/
     â”œâ”€ Backend sets is_read=true
     â”œâ”€ Next poll won't show it again
     â””â”€ Status: is_read=true

           â”‚
           â–¼

  4. ARCHIVED (User can view history)
     â”œâ”€ Stays in database
     â”œâ”€ Can be filtered and viewed
     â”œâ”€ Time-based cleanup optional
     â””â”€ Status: is_read=true (old)
```

---

## Polling Mechanism

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ POLLING LOOP (Every 5 Seconds)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  Start
    â”‚
    â–¼
  Timer: 0s â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                â”‚
    â”‚             Wait 5s
    â”‚                â”‚
    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   â”‚ Poll: GET /notifications/ â”‚
    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚                â”‚
    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   â”‚ Parse Response            â”‚
    â”‚   â”‚ Filter: type=new_order    â”‚
    â”‚   â”‚ Filter: is_read=false     â”‚
    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚                â”‚
    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   â”‚ Check Each Notification   â”‚
    â”‚   â”‚ in lastNotificationIds    â”‚
    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚                â”‚
    â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚       â”‚                 â”‚
    â”‚   Already seen?      New?
    â”‚       â”‚                 â”‚
    â”‚     Skip            Handle
    â”‚       â”‚                 â”‚
    â”‚       â”‚            â”œâ”€ Play Sound
    â”‚       â”‚            â”œâ”€ Browser Alert
    â”‚       â”‚            â”œâ”€ Mark Read
    â”‚       â”‚            â””â”€ Add to Set
    â”‚       â”‚
    â”‚       â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚            â”‚
    â”‚  Timer: 5s â”˜â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                               â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Error Handling Flow

```
Problem                         Solution                Result
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Sound fails              â†’ Fallback to Web Audio API   âœ… Sound
                                                       plays

API unreachable         â†’ Log error, continue polling  âœ… Retry
                         next cycle

Duplicate notification  â†’ Check Set of seen IDs        âœ… Skip
                         Skip if already processed

No permission for       â†’ Skip browser notif, but      âœ… Sound
browser notification    play sound anyway              still plays

Old notifications       â†’ Filter by is_read=false      âœ… No
in response            Skip already read              duplicates

Empty response          â†’ Continue polling              âœ… Retry
                                                       next cycle
```

---

## Performance Analysis

```
Operation                    Time         Frequency
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Polling interval start       0ms          Every 5s
API request roundtrip        50-100ms     Every 5s
Parse JSON response          <5ms         Every 5s
Database query               10-20ms      Every 5s
Sound generation             <100ms       On notification
Browser notification         <10ms        On notification
Mark as read request         50-100ms     On notification
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Total per cycle: ~100-130ms (idle)
Total per cycle: ~200-300ms (on notification)

CPU impact: < 2% during polling
Memory impact: ~5-10MB (Set tracking)
Network: ~1-2 requests per 5 seconds
```

---

## Security Boundaries

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Frontend (Untrusted)                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ useRiderNotifications Hook               â”‚ â”‚
â”‚  â”‚ - Has user token                         â”‚ â”‚
â”‚  â”‚ - Makes API calls                        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ SECURITY BOUNDARY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚        (Token Authentication)                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
â”‚                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Backend (Trusted)                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Notification API ViewSet                 â”‚ â”‚
â”‚  â”‚ - Validates token                        â”‚ â”‚
â”‚  â”‚ - Returns only user's notifications      â”‚ â”‚
â”‚  â”‚ - Filters by permission                  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Order Signal Handler                     â”‚ â”‚
â”‚  â”‚ - Runs on server                         â”‚ â”‚
â”‚  â”‚ - Creates notifications atomically       â”‚ â”‚
â”‚  â”‚ - User ID verified                       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Deployment Architecture

```
Production Server
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Docker Container / VPS             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Nginx (Reverse Proxy)         â”‚ â”‚
â”‚  â”‚ - HTTPS/SSL                   â”‚ â”‚
â”‚  â”‚ - Load balance                â”‚ â”‚
â”‚  â”‚ - Rate limit                  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚           â”‚                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Django Application            â”‚ â”‚
â”‚  â”‚ - API endpoints               â”‚ â”‚
â”‚  â”‚ - Token auth                  â”‚ â”‚
â”‚  â”‚ - Signal handlers             â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚           â”‚                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ PostgreSQL Database           â”‚ â”‚
â”‚  â”‚ - Notifications table         â”‚ â”‚
â”‚  â”‚ - Orders table                â”‚ â”‚
â”‚  â”‚ - Users table                 â”‚ â”‚
â”‚  â”‚ - Indexes for queries         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â–²                          â–²
     â”‚                          â”‚
  Riders                   Customers
  (Frontend)              (Frontend)
```

---

## Summary

This architecture provides:

âœ… **Real-time notifications** - Polled every 5 seconds
âœ… **Sound alerts** - Using Web Audio API
âœ… **Scalable** - Works with many riders and orders
âœ… **Secure** - Token-based authentication
âœ… **Reliable** - Error handling and fallbacks
âœ… **Performant** - Minimal CPU/memory impact
âœ… **User-friendly** - Auto-read, no duplicates, browser notifications

The system is production-ready and can handle thousands of orders per day.
